# Subquery Advanced (Subquery ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á)

## 4. ‡∏ï‡∏±‡∏ß‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å: IN / EXISTS / ANY / ALL

---

## 4.1 IN ‚Äì ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡∏∏‡∏î‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢

‡πÉ‡∏ä‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ ‡∏Ñ‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏î‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á**‡πÉ‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á subquery** ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

### ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö

```sql
WHERE x IN (SELECT y FROM table)
```

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

- **TRUE** ‡∏ñ‡πâ‡∏≤ `x` ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏î‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
- **FALSE** ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏î‡πÄ‡∏•‡∏¢
- **UNKNOWN** ‡∏ñ‡πâ‡∏≤ subquery ‡∏°‡∏µ NULL

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

‡∏≠‡∏¢‡∏≤‡∏Å‡∏´‡∏≤ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á

```sql
SELECT customerName
FROM customers
WHERE customerNumber IN (
    SELECT customerNumber FROM orders
);
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**: ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà potential customer)

### ‚ö†Ô∏è ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô: NULL ‡πÉ‡∏ô Subquery

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤**:
```sql
WHERE x IN (1, 2, NULL)
-- ‡∏ñ‡πâ‡∏≤ x = 3 ‚Üí ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå = UNKNOWN (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà FALSE)
-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå = "‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ" ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ SQL ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ NULL ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏î
```

**‡∏ú‡∏•**: ‡∏ö‡∏≤‡∏á database ‡∏Ñ‡∏∑‡∏ô 0 ‡πÅ‡∏ñ‡∏ß

**‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥**: ‡∏ñ‡πâ‡∏≤ subquery ‡∏≠‡∏≤‡∏à‡∏°‡∏µ NULL ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ `EXISTS` ‡πÅ‡∏ó‡∏ô `IN`

### NOT IN

```sql
WHERE x NOT IN (SELECT y FROM table)
```

‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô - ‡∏£‡∏∞‡∏ß‡∏±‡∏á NULL ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô

---

## 4.2 EXISTS ‚Äì ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÅ‡∏ñ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢

‡πÉ‡∏ä‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ subquery **‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏ñ‡∏ß‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà**

‡πÑ‡∏°‡πà‡∏™‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô ‡πÅ‡∏Ñ‡πà‡∏™‡∏ô‡∏ß‡πà‡∏≤ "‡∏°‡∏µ‡πÅ‡∏ñ‡∏ß‡πÑ‡∏´‡∏°"

### ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö

```sql
WHERE EXISTS (SELECT 1 FROM table WHERE ...)
```

(‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô `SELECT 1` ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏ô‡∏Ñ‡πà‡∏≤ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÅ‡∏ñ‡∏ß)

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

- **TRUE** ‚Äì ‡∏°‡∏µ‡πÅ‡∏ñ‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÅ‡∏ñ‡∏ß
- **FALSE** ‚Äì ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ñ‡∏ß

‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô UNKNOWN ‡πÅ‡∏°‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏µ NULL

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

‡∏´‡∏≤ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ order (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)

```sql
SELECT customerName
FROM customers c
WHERE EXISTS (
    SELECT 1
    FROM orders o
    WHERE o.customerNumber = c.customerNumber  -- correlated
);
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**: ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô IN (‡πÅ‡∏ï‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ï‡πà‡∏≠ NULL)

### NOT EXISTS

```sql
WHERE NOT EXISTS (SELECT 1 FROM orders WHERE ...)
```

‡∏´‡∏≤ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ order (potential customers)

```sql
SELECT customerName
FROM customers c
WHERE NOT EXISTS (
    SELECT 1
    FROM orders o
    WHERE o.customerNumber = c.customerNumber
);
```

### ‚úÖ ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô EXISTS

- ‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á‡∏à‡∏≤‡∏Å NULL ‚Üí ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- ‡∏°‡∏±‡∏Å‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ IN (subquery ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å)
- ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **correlated subquery**

---

## 4.3 ANY ‚Äì ‡∏¢‡πâ‡∏≠‡∏° x ‡∏Å‡∏±‡∏ö "‡∏Ñ‡πà‡∏≤‡πÉ‡∏î‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á"

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢

‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö `x` ‡∏Å‡∏±‡∏ö ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡πà‡∏≤ ‡πÉ‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á subquery

### ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö

```sql
WHERE x > ANY (SELECT y FROM table)
WHERE x = ANY (SELECT y FROM table)
WHERE x < ANY (SELECT y FROM table)
```

### ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

```sql
x > ANY (1, 3, 10)
-- ‡∏ñ‡πâ‡∏≤ x = 5 ‚Üí TRUE (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ 5 > 1)
-- ‡∏ñ‡πâ‡∏≤ x = 2 ‚Üí TRUE (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ 2 > 1)
-- ‡∏ñ‡πâ‡∏≤ x = 0 ‚Üí FALSE (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ 0 ‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1, 3, 10)

-- ‡πÉ‡∏ô‡∏ó‡∏≤‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ = x > MIN(1, 3, 10) = x > 1
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

‡∏´‡∏≤ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ‡∏£‡∏ñ Classic Cars ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ä‡∏¥‡πâ‡∏ô

```sql
SELECT productName
FROM products
WHERE buyPrice < ANY (
    SELECT buyPrice
    FROM products
    WHERE productLine = 'Classic Cars'
);
```

**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢**: "buyPrice ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ buyPrice ‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ buyPrice ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ï‡∏±‡∏ß"

### ‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

- `x > ANY(...)` ‡∏Å‡∏±‡∏ö `x IN (...)` **‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô**
- `= ANY(...)` ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö `IN(...)`
- `> ANY(...)` ‚â† `> IN(...)`

### ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

| Operator | ANY | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ | ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö |
|----------|-----|----------|---------|
| `x > ANY (1, 3, 10)` | > ‚â• 1 ‡∏ï‡∏±‡∏ß | x > 1 (MIN) | `x > MIN(...)` |
| `x < ANY (1, 3, 10)` | < ‚â• 1 ‡∏ï‡∏±‡∏ß | x < 10 (MAX) | `x < MAX(...)` |
| `x = ANY (1, 3, 10)` | = ‚â• 1 ‡∏ï‡∏±‡∏ß | x = 1 or 3 or 10 | `x IN (...)` |

---

## 4.4 ALL ‚Äì ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö "‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤"

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢

‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö `x` ‡∏Å‡∏±‡∏ö **‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤** ‡πÉ‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á subquery

‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö

```sql
WHERE x > ALL (SELECT y FROM table)
WHERE x = ALL (SELECT y FROM table)
WHERE x < ALL (SELECT y FROM table)
```

### ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

```sql
x > ALL (1, 3, 10)
-- ‡∏ñ‡πâ‡∏≤ x = 11 ‚Üí TRUE (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ 11 > 1, 3, 10 ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
-- ‡∏ñ‡πâ‡∏≤ x = 5 ‚Üí FALSE (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ 5 ‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 10)
-- ‡∏ñ‡πâ‡∏≤ x = 20 ‚Üí TRUE (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ 20 > 1, 3, 10 ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)

-- ‡πÉ‡∏ô‡∏ó‡∏≤‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ = x > MAX(1, 3, 10) = x > 10
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

‡∏´‡∏≤ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏û‡∏á‡∏Å‡∏ß‡πà‡∏≤ ‡∏£‡∏ñ Classic Cars **‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß**

```sql
SELECT productName
FROM products
WHERE buyPrice > ALL (
    SELECT buyPrice
    FROM products
    WHERE productLine = 'Classic Cars'
);
```

**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢**: "buyPrice ‡πÅ‡∏û‡∏á‡∏Å‡∏ß‡πà‡∏≤ buyPrice ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á Classic Cars"

### ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

| Operator | ALL | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ | ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö |
|----------|-----|----------|---------|
| `x > ALL (1, 3, 10)` | > ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î | x > 10 (MAX) | `x > MAX(...)` |
| `x < ALL (1, 3, 10)` | < ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î | x < 1 (MIN) | `x < MIN(...)` |
| `x = ALL (1, 3, 10)` | = ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î | ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ |

---

## 5. IN vs EXISTS (‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö)

| ‡πÄ‡∏Å‡∏ì‡∏ë‡πå | IN | EXISTS |
|------|-----|--------|
| **‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡πà‡∏≤** | ‡πÉ‡∏ä‡πà | ‡πÑ‡∏°‡πà |
| **‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÅ‡∏ñ‡∏ß** | ‡∏≠‡πâ‡∏≠‡∏° | ‡∏ï‡∏£‡∏á ‚úÖ |
| **‡∏Å‡∏±‡∏ö NULL** | ‡∏û‡∏±‡∏á‡πÑ‡∏î‡πâ ‚ùå | ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‚úÖ |
| **Performance** | ‡∏ä‡πâ‡∏≤‡πÑ‡∏î‡πâ | ‡∏°‡∏±‡∏Å‡πÄ‡∏£‡πá‡∏ß ‚úÖ |
| **Correlated** | ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞ | ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏°‡∏≤‡∏Å ‚úÖ |

### ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

üëâ **‡∏ñ‡πâ‡∏≤‡πÇ‡∏à‡∏ó‡∏¢‡πå**: "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ order" ‚Üí `EXISTS`

üëâ **‡∏ñ‡πâ‡∏≤‡πÇ‡∏à‡∏ó‡∏¢‡πå**: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô list ‡∏ô‡∏µ‡πâ" ‚Üí `IN`

---

## 6. ANY vs ALL (‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏£‡πá‡∏ß)

| ‡πÄ‡∏Å‡∏ì‡∏ë‡πå | ANY | ALL |
|------|-----|-----|
| **‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡πà‡∏≤** | ‚úÖ | ‚ùå |
| **‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤** | ‚ùå | ‚úÖ |
| **‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö** | MIN | MAX |
| **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á** | "‡∏ñ‡∏π‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ" | "‡πÅ‡∏û‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô" |

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ANY vs ALL

```sql
-- ANY: ‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ ‚â• 1 org
SELECT empName FROM employees
WHERE salary > ANY (SELECT salary FROM employees WHERE dept = 'IT');
-- ‚Üí ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ ‡∏Ñ‡∏ô‡πÉ‡∏î‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô IT

-- ALL: ‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Sales
SELECT empName FROM employees
WHERE salary > ALL (SELECT salary FROM employees WHERE dept = 'Sales');
-- ‚Üí ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ ‡∏Ñ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Sales
```

---

## 7. NULL ‡∏Å‡∏±‡∏ö IN / NOT IN (‡∏£‡∏∞‡∏ß‡∏±‡∏á!)

| ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç | ‡∏ñ‡πâ‡∏≤ Subquery ‡∏°‡∏µ NULL | ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå |
|------|------|-------|
| `x IN (subquery)` | ‡∏°‡∏µ NULL | ‡∏≠‡∏≤‡∏à‡∏Ñ‡∏∑‡∏ô 0 ‡πÅ‡∏ñ‡∏ß |
| `x NOT IN (subquery)` | ‡∏°‡∏µ NULL | ‡∏°‡∏±‡∏Å‡∏Ñ‡∏∑‡∏ô 0 ‡πÅ‡∏ñ‡∏ß ‚ùå |
| `x IN (SELECT ... WHERE ... IS NOT NULL)` | ‡∏ï‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß | ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‚úÖ |
| `EXISTS (SELECT 1 FROM ...)` | ‡πÑ‡∏°‡πà‡∏™‡∏ô | ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‚úÖ |

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

```sql
-- ‚ùå ‡πÑ‡∏°‡πà‡∏î‡∏µ: ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ department
SELECT empName
FROM employees
WHERE dept NOT IN (SELECT dept FROM employees);
-- ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î

-- ‚úÖ ‡∏î‡∏µ: ‡∏£‡∏∞‡∏ö‡∏∏ IS NOT NULL
SELECT empName
FROM employees
WHERE dept NOT IN (SELECT dept FROM employees WHERE dept IS NOT NULL);

-- ‚úÖ ‡∏î‡∏µ: ‡πÉ‡∏ä‡πâ NOT EXISTS
SELECT empName
FROM employees e
WHERE NOT EXISTS (SELECT 1 FROM employees WHERE dept = e.dept);
```

---

## 8. Derived Table ‡πÅ‡∏•‡∏∞ CTE

### Derived Table (Subquery ‡πÉ‡∏ô FROM)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á**: ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 500000

```sql
SELECT productLine, totalRevenue
FROM (
    SELECT p.productLine,
           SUM(od.quantityOrdered * od.priceEach) AS totalRevenue
    FROM products p
    JOIN orderdetails od ON p.productCode = od.productCode
    GROUP BY p.productLine
) AS productLineRevenue
WHERE totalRevenue > 500000;
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ**:
- ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
- Syntax ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢**:
- ‡∏≠‡πà‡∏≤‡∏ô‡∏¢‡∏≤‡∏Å
- ‡∏¢‡∏≤‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£ debug

---

### CTE (Common Table Expression) ‚Äì WITH

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á**: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ order ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏≤ order ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

```sql
WITH lineitems AS (
    SELECT orderNumber, COUNT(*) AS items
    FROM orderdetails
    GROUP BY orderNumber
)
SELECT orderNumber, items
FROM lineitems
WHERE items = (SELECT MAX(items) FROM lineitems);
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ**:
- ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‚úÖ
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏´‡∏•‡∏≤‡∏¢ ‚úÖ
- ‡πÉ‡∏ä‡πâ recursive CTE ‡πÑ‡∏î‡πâ ‚úÖ

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢**:
- ‡∏ö‡∏≤‡∏á database ‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö

---

## 9. Correlated Subquery (‡∏•‡∏∂‡∏Å‡∏ã‡∏∂‡πâ‡∏á)

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢

Subquery ‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å **outer query**

‡∏ó‡∏≥‡πÉ‡∏´‡πâ subquery ‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß‡∏Ç‡∏≠‡∏á outer query

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

‡∏´‡∏≤ customer ‡∏ó‡∏µ‡πà‡∏°‡∏µ order ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏à‡∏≥‡∏ô‡∏ß‡∏ô order ‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

```sql
SELECT c.customerNumber, c.customerName,
       (SELECT COUNT(*) FROM orders o WHERE o.customerNumber = c.customerNumber) AS order_count
FROM customers c
WHERE order_count > (
    SELECT AVG(order_cnt)
    FROM (
        SELECT COUNT(*) AS order_cnt
        FROM orders
        GROUP BY customerNumber
    ) AS avg_orders
);
```

### Performance

‚ùå ‡∏°‡∏±‡∏Å‡∏ä‡πâ‡∏≤ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏£‡∏±‡∏ô subquery ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á

‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô query ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ JOIN ‡πÅay CTE ‡πÅ‡∏ó‡∏ô

---

## ‡∏™‡∏£‡∏∏‡∏õ

| Concept | ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ | ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á |
|---------|--------|---------|
| **IN** | ‡∏Ñ‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô list | `WHERE id IN (1, 2, 3)` |
| **EXISTS** | ‡∏°‡∏µ‡πÅ‡∏ñ‡∏ß | `WHERE EXISTS (SELECT 1 FROM ...)` |
| **ANY** | ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö ‚â• 1 ‡∏Ñ‡πà‡∏≤ | `WHERE price < ANY(SELECT ...)` |
| **ALL** | ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö ‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤ | `WHERE price > ALL(SELECT ...)` |
| **Derived Table** | subquery ‡πÉ‡∏ô FROM | `FROM (SELECT ...) AS t` |
| **CTE** | subquery ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô | `WITH t AS (SELECT ...) SELECT FROM t` |

---

**‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤**: [01-subquery-basics.md](01-subquery-basics.md) - Subquery Basics
