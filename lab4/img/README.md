# Lab 4: Subquery (à¸„à¸³à¸ªà¸±à¹ˆà¸‡ SELECT à¸‹à¹‰à¸­à¸™)

## ðŸ“š à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” Lab

Lab à¸™à¸µà¹‰à¸¨à¸¶à¸à¸©à¸² **Subquery** (Inner Query / Nested Query) à¸‹à¸¶à¹ˆà¸‡à¹€à¸›à¹‡à¸™à¹€à¸—à¸„à¸™à¸´à¸„à¸žà¸·à¹‰à¸™à¸à¸²à¸™à¹ƒà¸™à¸à¸²à¸£à¹€à¸‚à¸µà¸¢à¸™ SQL à¸—à¸µà¹ˆà¸¢à¸²à¸§à¹à¸¥à¸°à¸‹à¸±à¸šà¸‹à¹‰à¸­à¸™

Lab à¹à¸šà¹ˆà¸‡à¸­à¸­à¸à¹€à¸›à¹‡à¸™ 2 à¸ªà¹ˆà¸§à¸™:

**à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 1** - Subquery à¸žà¸·à¹‰à¸™à¸à¸²à¸™ â†’ [01-subquery-basics.md](01-subquery-basics.md)  
**à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 2** - Subquery à¸‚à¸±à¹‰à¸™à¸ªà¸¹à¸‡ (IN, EXISTS, ANY, ALL) â†’ [02-subquery-advanced.md](02-subquery-advanced.md)

---

## ðŸ“ à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ

```
lab4/
â”œâ”€â”€ README.md                      # à¹„à¸Ÿà¸¥à¹Œà¸™à¸µà¹‰ - à¸ à¸²à¸žà¸£à¸§à¸¡à¹à¸¥à¸°à¸„à¸¹à¹ˆà¸¡à¸·à¸­
â”œâ”€â”€ 01-subquery-basics.md          # à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 1: à¸žà¸·à¹‰à¸™à¸à¸²à¸™
â”œâ”€â”€ 02-subquery-advanced.md        # à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 2: à¸‚à¸±à¹‰à¸™à¸ªà¸¹à¸‡ (IN, EXISTS, ANY, ALL)
â”œâ”€â”€ img/                           # à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œà¸£à¸¹à¸›à¸ à¸²à¸žà¸›à¸£à¸°à¸à¸­à¸šà¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œ
â””â”€â”€ exercise/                     # à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œà¹à¸šà¸šà¸à¸¶à¸à¸«à¸±à¸”
    â”œâ”€â”€ Challenge.ipynb
    â”œâ”€â”€ IN-NOTIN-ANY.ipynb
    â”œâ”€â”€ Subqueries_exercise.ipynb
    â””â”€â”€ last-exercise.ipynb
```

---

## Overview

### Subquery à¸„à¸·à¸­à¸­à¸°à¹„à¸£?

**Subquery** à¸„à¸·à¸­ query à¸‹à¹‰à¸­à¸™à¹ƒà¸™ query à¸­à¸µà¸à¸—à¸µ  
à¸­à¸µà¸à¸Šà¸·à¹ˆà¸­à¸«à¸™à¸¶à¹ˆà¸‡: **Inner Query** à¸«à¸£à¸·à¸­ **Nested Query**

### à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™

```sql
-- à¸—à¸±à¹ˆà¸§à¹„à¸›: à¸­à¸¢à¸²à¸à¸£à¸¹à¹‰ salary à¸‚à¸­à¸‡ Diane Murphy à¸à¹ˆà¸­à¸™
SELECT * FROM employees
WHERE salary > (
    SELECT salary 
    FROM employees 
    WHERE name = 'Diane Murphy'
);
```

### à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸«à¸£à¹ˆà¸ˆà¸¶à¸‡à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰?

- à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸£à¸¹à¹‰à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸š à¸•à¹‰à¸­à¸‡à¸£à¸±à¸™à¹à¸¥à¹‰à¸§à¸„à¹ˆà¸­à¸¢ query à¸•à¹ˆà¸­
- à¸•à¹‰à¸­à¸‡à¹€à¸­à¸²à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸ˆà¸²à¸ query à¸«à¸™à¸¶à¹ˆà¸‡à¹„à¸›à¹ƒà¸Šà¹‰à¹€à¸›à¹‡à¸™à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¸‚à¸­à¸‡ query à¸­à¸·à¹ˆà¸™

---

## ðŸ“– à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¹‚à¸”à¸¢à¸ªà¸£à¸¸à¸›

### à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 1: Subquery Basics

#### 1. à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹à¸¥à¸°à¸¥à¸³à¸”à¸±à¸šà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡ SQL
- SELECT â†’ FROM â†’ WHERE â†’ GROUP BY â†’ HAVING â†’ ORDER BY
- **à¸¥à¸³à¸”à¸±à¸šà¸—à¸µà¹ˆ SQL à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥**: FROM â†’ WHERE â†’ GROUP BY â†’ HAVING â†’ SELECT â†’ ORDER BY

#### 2. Subquery à¸„à¸·à¸­à¸­à¸°à¹„à¸£?
- Query à¸‹à¹‰à¸­à¸™à¹ƒà¸™ query
- à¹ƒà¸Šà¹‰à¹€à¸¡à¸·à¹ˆà¸­à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸ˆà¸²à¸ query à¸«à¸™à¸¶à¹ˆà¸‡à¹„à¸›à¹ƒà¸Šà¹‰à¸•à¹ˆà¸­

#### 3. à¸›à¸£à¸°à¹€à¸ à¸— Subquery
- **Single-Row Subquery** - à¸„à¸·à¸™ 1 à¹à¸–à¸§ à¹€à¸›à¸£à¸µà¸¢à¸š `=, >, <`
- **Scalar Subquery** - 1 à¹à¸–à¸§ 1 à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ à¹€à¸›à¹‡à¸™à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹ƒà¸™à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œ
- **Multi-Column Subquery** - 1 à¹à¸–à¸§ à¸«à¸¥à¸²à¸¢à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ à¹€à¸Šà¹ˆà¸™ `(dept, salary)`
- **Multi-Row Subquery** - à¸«à¸¥à¸²à¸¢à¹à¸–à¸§ à¹ƒà¸Šà¹‰ `IN, ANY, ALL, EXISTS`
- **Correlated Subquery** - à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡à¸„à¹ˆà¸²à¸ˆà¸²à¸ outer query à¸£à¸±à¸™ 1 à¸„à¸£à¸±à¹‰à¸‡à¸•à¹ˆà¸­ 1 à¹à¸–à¸§

---

### à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 2: Subquery Advanced

#### 4. à¸•à¸±à¸§à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸«à¸¥à¸±à¸
- **IN** â€“ à¸„à¹ˆà¸²à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ list (à¸£à¸°à¸§à¸±à¸‡ NULL!)
- **EXISTS** â€“ à¸¡à¸µà¹à¸–à¸§ (à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¸•à¹ˆà¸­ NULL)
- **ANY** â€“ à¹€à¸›à¸£à¸µà¸¢à¸šà¸à¸±à¸š â‰¥ 1 à¸„à¹ˆà¸² (à¹€à¸«à¸¡à¸·à¸­à¸™ MIN)
- **ALL** â€“ à¹€à¸›à¸£à¸µà¸¢à¸šà¸à¸±à¸š à¸—à¸¸à¸à¸„à¹ˆà¸² (à¹€à¸«à¸¡à¸·à¸­à¸™ MAX)

#### 5. IN vs EXISTS
| à¹€à¸à¸“à¸‘à¹Œ | IN | EXISTS |
|------|-----|--------|
| à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸šà¸„à¹ˆà¸² | à¹ƒà¸Šà¹ˆ | à¹„à¸¡à¹ˆ (à¹€à¸Šà¹‡à¸„à¸¡à¸µà¹à¸–à¸§) |
| à¸à¸±à¸š NULL | à¸žà¸±à¸‡ | à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ |
| Performance | à¸Šà¹‰à¸² | à¹€à¸£à¹‡à¸§ |

#### 6. ANY vs ALL
- **ANY** - à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ TRUE â†’ à¹€à¸«à¸¡à¸·à¸­à¸™ MIN
- **ALL** - à¸—à¸¸à¸à¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ TRUE â†’ à¹€à¸«à¸¡à¸·à¸­à¸™ MAX

#### 7. Derived Table (Subquery à¹ƒà¸™ FROM)
```sql
FROM (SELECT ... WHERE ...) AS derived_name
```

#### 8. CTE (Common Table Expression) â€“ WITH
```sql
WITH temp AS (SELECT ...)
SELECT * FROM temp;
```

---

## ðŸš€ à¸à¸²à¸£à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹ƒà¸Šà¹‰à¸‡à¸²à¸™

### 1. à¸­à¹ˆà¸²à¸™à¹„à¸Ÿà¸¥à¹Œà¸•à¸²à¸¡à¸¥à¸³à¸”à¸±à¸š

1. **à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸—à¸µà¹ˆ**: [01-subquery-basics.md](01-subquery-basics.md)
   - à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰à¸žà¸·à¹‰à¸™à¸à¸²à¸™ subquery
   - à¸›à¸£à¸°à¹€à¸ à¸—à¸•à¹ˆà¸²à¸‡à¹†
   - à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸žà¸·à¹‰à¸™à¸à¸²à¸™

2. **à¸•à¹ˆà¸­à¸”à¹‰à¸§à¸¢**: [02-subquery-advanced.md](02-subquery-advanced.md)
   - à¸•à¸±à¸§à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£ IN, EXISTS, ANY, ALL
   - Derived Table à¹à¸¥à¸° CTE
   - Best Practices

### 2. à¸à¸¶à¸à¸à¸™

à¹ƒà¸Šà¹‰ Jupyter Notebooks à¹ƒà¸™à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œà¸™à¸µà¹‰:
- `Subqueries_exercise.ipynb` - à¹à¸šà¸šà¸à¸¶à¸à¸«à¸±à¸”
- `IN-NOTIN-ANY.ipynb` - à¸à¸¶à¸ IN/NOT IN/ANY
- `Challenge.ipynb` - à¹‚à¸ˆà¸—à¸¢à¹Œà¸—à¹‰à¸²à¸—à¸²à¸¢
- `last-exercise.ipynb` - à¹à¸šà¸šà¸à¸¶à¸à¸«à¸±à¸”à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢

### 3. Database Setup

à¹ƒà¸Šà¹‰ **Classic Models Database**:
```sql
-- à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¸ˆà¸²à¸: https://luckkrit.github.io/cos3103/sql/postgresql-classicmodels.sql
SET search_path TO public, classicmodels;
```

---

## ðŸŽ¯ à¸ˆà¸¸à¸”à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œà¸‚à¸­à¸‡ Lab

à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¸¨à¸¶à¸à¸©à¸² Lab à¸™à¸µà¹‰ à¸„à¸¸à¸“à¸ˆà¸°à¸ªà¸²à¸¡à¸²à¸£à¸–:

âœ… à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸¥à¸³à¸”à¸±à¸šà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡ SQL  
âœ… à¹€à¸‚à¸µà¸¢à¸™ Subquery à¸žà¸·à¹‰à¸™à¸à¸²à¸™à¹à¸¥à¸°à¸‚à¸±à¹‰à¸™à¸ªà¸¹à¸‡  
âœ… à¹€à¸¥à¸·à¸­à¸à¹ƒà¸Šà¹‰ operators à¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡ (IN, EXISTS, ANY, ALL)  
âœ… à¹ƒà¸Šà¹‰ Derived Table à¹à¸¥à¸° CTE à¸­à¸¢à¹ˆà¸²à¸‡à¸¡à¸µà¸›à¸£à¸°à¸ªà¸´à¸—à¸˜à¸´à¸ à¸²à¸ž  
âœ… à¸«à¸¥à¸µà¸à¹€à¸¥à¸µà¹ˆà¸¢à¸‡à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¸—à¸±à¹ˆà¸§à¹„à¸› (NULL, performance)  
âœ… à¹€à¸‚à¸µà¸¢à¸™ SQL queries à¸—à¸µà¹ˆà¸­à¹ˆà¸²à¸™à¸‡à¹ˆà¸²à¸¢à¹à¸¥à¸°à¸¡à¸µà¸›à¸£à¸°à¸ªà¸´à¸—à¸˜à¸´à¸ à¸²à¸ž

---

**à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸**: Lab à¸™à¸µà¹‰à¹€à¸›à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¸«à¸™à¸¶à¹ˆà¸‡à¸‚à¸­à¸‡à¸§à¸´à¸Šà¸² Database à¸Šà¸±à¹‰à¸™à¸›à¸µà¸—à¸µà¹ˆ 3 à¹€à¸—à¸­à¸¡ 2
